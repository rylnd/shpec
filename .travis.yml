language: sh
cache: apt
env:
  matrix:
    - LINT=true
    - SHELL=bash
    - SHELL=dash
    - SHELL=ksh
    - SHELL=zsh
    - LANG=de_DE.UTF-8
    - LANG=fr_FR.UTF-8
matrix:
  include:
    - os: osx
      env: SHELL=bash
  exclude:
    - os: osx
  fast_finish: true
os:
  - linux
  - osx
script:
  - |
    $SHELL --version

    if [ "$SHELL" = "zsh" ]; then
      cat > $HOME/.zshenv <<END
        disable -r end
        setopt sh_word_split
    END

    fi
    if ${LINT:-false}; then
      shellcheck -s sh bin/shpec  # 'sh' refers to POSIX
    else
      $SHELL bin/shpec
    fi
before_install:
  - |
    if [ "${TRAVIS_OS_NAME}" = "linux" ]; then
      get_shellcheck() {
        (
        for v
        do
          pkg=shellcheck_${v}_amd64.deb
          url="http://ftp.debian.org/debian/pool/main/s/shellcheck/"
          wget $url/$pkg || continue
          echo $pkg
          break
        done
        )
      }
      install_shell(){
        echo "Install $SHELL"
        sudo apt-get update -qq
        sudo apt-get install -y $SHELL
      }

      if ${LINT:-false}; then
        pkg=$( get_shellcheck 0.3.5-3 0.3.4-3 )
        sudo dpkg -i $pkg
      elif ! type $SHELL > /dev/null; then
        install_shell
      fi
    fi
  - sudo apt-get update && sudo apt-get --reinstall install -qq language-pack-en language-pack-de language-pack-fr